name: List PR Changes and Call API

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  list-changes:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: List changes
        run: |
          # Get the base and head commit hashes
          BASE_COMMIT=$(git rev-parse --short origin/${GITHUB_BASE_REF})
          HEAD_COMMIT=$(git rev-parse --short origin/${GITHUB_HEAD_REF})

          # Store the diff in a variable
          DIFF=""
          
          # Loop through each file changed in the PR and append to DIFF
          git diff --name-only ${BASE_COMMIT}..${HEAD_COMMIT} | while read file; do
            DIFF="${DIFF}$(git diff ${BASE_COMMIT}..${HEAD_COMMIT} -- $file)"
            DIFF="${DIFF}\n------------------------\n"
          done
          
          # Echo the diff
          echo -e $DIFF
          echo "test"
          
          # Save diff to a file
          echo -e $DIFF > diff.txt
      
      - name: Print diff
        run: |
          echo "=== DIFF OUTPUT ==="
          cat diff.txt
          echo "=== END DIFF ==="
